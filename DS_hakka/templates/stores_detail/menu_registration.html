<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒˆã‚¢ç®¡ç† - å•†å“ç™»éŒ²</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stores_detail.css') }}">
    <style>
        /* ã“ã®ãƒšãƒ¼ã‚¸å°‚ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .main-content {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .registration-container {
            flex: 1;
            min-width: 350px;
        }
        .menu-list-container {
            flex: 2;
            min-width: 400px;
        }
        .menu-list-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .menu-list-table th, .menu-list-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .menu-list-table th {
            background-color: #f2f2f2;
        }
        .delete-button {
            background-color: #f44336;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-button:hover {
            background-color: #da190b;
        }
        .flash-messages {
            list-style-type: none;
            padding: 0;
            margin-bottom: 1rem;
        }
        .flash-messages li {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .flash-messages .success { background-color: #d4edda; color: #155724; }
        .flash-messages .error { background-color: #f8d7da; color: #721c24; }
        .flash-messages .warning { background-color: #fff3cd; color: #856404; }
        .flash-messages .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <header class="site-header">
        <h1>{{ store_name }} - å•†å“ç™»éŒ²</h1>
        <div class="header-links">
            <div class="store-name">ãƒ­ã‚°ã‚¤ãƒ³ä¸­: {{ store_name if store_name else 'ã‚²ã‚¹ãƒˆ' }}</div>
            <a href="#">ã‚¹ãƒˆã‚¢æƒ…å ±</a> <!-- TODO: url_for('stores_detail.store_info') -->
            <a href="{{url_for('users_home.logout')}}">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
        </div>
    </header>
    <nav class="main-nav">
        <ul>
            <li><a href="{{ url_for('stores_detail.store_home') }}">ãƒ›ãƒ¼ãƒ </a></li>
            <li><a href="{{ url_for('stores_detail.menu_registration') }} "class="active">å•†å“ç™»éŒ²</a></li>
            <li><a href="{{ url_for('stores_detail.order_list') }}">æ³¨æ–‡ãƒªã‚¹ãƒˆ</a></li>
            <li><a href="{{ url_for('stores_detail.paypay_linking') }}" >paypayã®ç´ä»˜ã‘</a></li>
            <li><a href="{{ url_for('stores_detail.procedure') }}">æ‰‹é †ãƒšãƒ¼ã‚¸</a></li>
        </ul>
    </nav>
    <main class="main-container">
        <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flash-messages">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        <div class="main-content">
            <!-- å·¦å´: ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="registration-container">
                <h2>æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç™»éŒ²</h2>
                <form action="{{ url_for('stores_detail.menu_preview') }}" method="POST" enctype="multipart/form-data">
                    <div class="template-download-area">
                        <a href="{{ url_for('stores_detail.download_template') }}" class="download-button">ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ(Excel)ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                    </div>
                    <div class="registration-area">
                        <div class="content-box upload-zone">
                            <label for="file-upload" class="file-drop-area">
                                <span class="file-icon">ğŸ“¤</span>
                                <span id="file-msg">ã“ã“ã«CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</span>
                            </label>
                            <input type="file" id="file-upload" name="product_csv" class="file-input-hidden" accept=".csv, .xlsx, .xls">
                        </div>
                        <p style="text-align: center; margin: 1rem 0;">ã¾ãŸã¯</p>
                        <div class="content-box manual-input-zone">
                            <div class="form-fields">
                                <div class="form-group">
                                    <label for="product-name">å•†å“å</label>
                                    <input type="text" id="product-name" name="product_name" placeholder="ä¾‹ï¼šæ—¥æ›¿ã‚ã‚Šãƒ©ãƒ³ãƒ">
                                </div>
                                <div class="form-group">
                                    <label for="product-price">å€¤æ®µï¼ˆå††ï¼‰</label>
                                    <input type="number" id="product-price" name="product_price" placeholder="ä¾‹: 500">
                                </div>
                                <div class="form-group">
                                    <label for="product-description">ã‚«ãƒ†ã‚´ãƒª/å•†å“èª¬æ˜</label>
                                    <textarea id="product-description" name="product_description" rows="3" placeholder="å•†å“ã®ç‰¹å¾´ãªã©ã‚’å…¥åŠ›"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="confirmation-area">
                        <button type="submit" class="confirm-button">ç¢ºèªã¸</button>
                    </div>
                </form>
            </div>
            <!-- å³å´: ç™»éŒ²æ¸ˆã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ -->
            <div class="menu-list-container">
                <h2>ç™»éŒ²æ¸ˆã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§</h2>
                {% if menus %}
                    <table class="menu-list-table">
                        <thead>
                            <tr>
                                <th>å•†å“å</th>
                                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                                <th>å€¤æ®µ</th>
                                <th>åœ¨åº«</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for menu in menus %}
                            <tr>
                                <td>{{ menu.menu_name }}</td>
                                <td>{{ menu.category }}</td>
                                <td>{{ menu.price }} å††</td>
                                <td>{{ 'å£²ã‚Šåˆ‡ã‚Œ' if menu.soldout == 1 else 'è²©å£²ä¸­' }}</td>
                                <td>
                                    <form action="{{ url_for('stores_detail.menu_delete', menu_id=menu.menu_id) }}" method="POST" onsubmit="return confirm('æœ¬å½“ã«ã“ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                                        <button type="submit" class="delete-button">å‰Šé™¤</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>ç¾åœ¨ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                {% endif %}
            </div>
        </div>
    </main>
    <script>
        const fileUpload = document.getElementById('file-upload');
        const fileMsg = document.getElementById('file-msg');
        fileUpload.addEventListener('change', () => {
            if (fileUpload.files.length > 0) {
                fileMsg.textContent = fileUpload.files[0].name;
            } else {
                fileMsg.innerHTML = 'ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ';
            }
        });
    </script>
</body>
</html>
